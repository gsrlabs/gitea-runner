# üèÉ Gitea Act Runner - Self-Hosted CI/CD Runner

–ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Gitea Actions Runner –Ω–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker Compose.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- ‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏** ‚Äî –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
- ‚úÖ **Docker-based execution** ‚Äî –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö
- ‚úÖ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gitea** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Actions** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Gitea Actions
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–Ω–Ω–µ—Ä–æ–≤
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º –æ–±—Ä–∞–∑–æ–º

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–í–∞—à Gitea —Å–µ—Ä–≤–µ—Ä (https://gitea.your-domain.com)
         ‚îÇ
         ‚ñº
    Act Runner ‚Üê‚îÄ‚îÄ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ webhook'–∏
         ‚îÇ
         ‚ñº
  –ó–∞–ø—É—Å–∫–∞–µ—Ç Docker ‚Üê‚îÄ‚îÄ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏
         ‚îÇ
         ‚ñº
–í—ã–ø–æ–ª–Ω—è–µ—Ç workflow ‚Üê‚îÄ‚îÄ –∏–∑ .gitea/workflows/*.yml
```

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **Ubuntu/Debian —Å–µ—Ä–≤–µ—Ä** —Å Docker –∏ Docker Compose
- **–î–æ—Å—Ç—É–ø –∫ Docker daemon** (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –≥—Ä—É–ø–ø–µ `docker`)
- **–°–µ—Ç—å Gitea** ‚Äî —Ä–∞–Ω–Ω–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ç–æ–π –∂–µ Docker —Å–µ—Ç–∏, —á—Ç–æ –∏ Gitea 

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ Gitea
- **[Gitea](https://github.com/gsrlabs/gitea-compose) –≤–µ—Ä—Å–∏–∏ 1.19+** —Å –≤–∫–ª—é—á–µ–Ω–Ω—ã–º–∏ Actions
- **–¢–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** —Ä–∞–Ω–Ω–µ—Ä–∞ (—Å–º. —Ä–∞–∑–¥–µ–ª "–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞")

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
cd /home/your/directory/
git clone https://github.com/gsrlabs/gitea-runner.git gitea-runner
cd gitea-runner
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏ Gitea
–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–µ—Ç—å Gitea:
```bash
docker network ls | grep gitea_gitea # –∏–ª–∏ gitea_network
```
–ï—Å–ª–∏ —Å–µ—Ç–∏ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ—ë:
```bash
docker network create gitea_gitea # –∏–ª–∏ gitea_network
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`:
```bash
touch .env
nano .env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
RUNNER_TOKEN="YOUR_TOKEN_REGISTRATION"
GITEA_INSTANCE_URL="https://gitea.your-domain.com"

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
RUNNER_LABELS="ubuntu-latest:docker://node:20-bullseye,ubuntu-22.04:docker://node:20-bullseye,self-hosted"
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
–¢–æ–∫–µ–Ω –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è —Ä–∞–Ω–Ω–µ—Ä–∞:

#### –£—Ä–æ–≤–µ–Ω—å —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ (–≤—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: `https://gitea.your-domain.com/-/admin/actions/runners`
2. –ù–∞–∂–º–∏—Ç–µ "Create new runner"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –£—Ä–æ–≤–µ–Ω—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏: `https://gitea.your-domain.com/orgs/{org}/settings/actions/runners`
2. –ù–∞–∂–º–∏—Ç–µ "Create new runner"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

#### –£—Ä–æ–≤–µ–Ω—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
1. –û—Ç–∫—Ä–æ–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `https://gitea.your-domain.com/{owner}/{repo}/settings/actions/runners`
2. –ù–∞–∂–º–∏—Ç–µ "Create new runner"
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

> **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –¢–æ–∫–µ–Ω –∏–º–µ–µ—Ç –≤–∏–¥: `D0gvfu2iHfUjNqCYVljVyRV14fISpJxxxxxxxxxx`

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞**
–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–∞–∑–æ–≤—ã–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–º–∞–Ω–¥–æ–π:
```bash
docker run --rm --entrypoint="" docker.io/gitea/act_runner:latest act_runner generate-config > config.yaml
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ config.yaml:
```bash
nano config.yaml
```

–ö–ª—é—á–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```yaml
container:
  network: "gitea_gitea"  # /gitea_network –°–µ—Ç—å –¥–æ–ª–∂–Ω–∞ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å —Å–µ—Ç—å—é Gitea
  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
  # privileged: false      # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –≤ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
  # options:              # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ü–∏–∏ Docker
  #   --dns: 8.8.8.8
```

### 6. –ó–∞–ø—É—Å–∫ —Ä–∞–Ω–Ω–µ—Ä–∞
```bash
docker compose up -d
```

### 7. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
docker compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker compose ps
```

## ‚öôÔ∏è –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–µ–π–±–ª–æ–≤ —Ä–∞–Ω–Ω–µ—Ä–∞
–õ–µ–π–±–ª—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç, –∫–∞–∫–∏–µ –∑–∞–¥–∞—á–∏ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–Ω–Ω–µ—Ä:

```bash
# –í .env —Ñ–∞–π–ª–µ:
RUNNER_LABELS="ubuntu-latest:docker://node:20-bullseye,ubuntu-22.04:docker://node:20-bullseye,self-hosted:host"
```

#### –§–æ—Ä–º–∞—Ç –ª–µ–π–±–ª–æ–≤:
- `ubuntu-latest:docker://node:20-bullseye` ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ —Å –æ–±—Ä–∞–∑–æ–º Node.js
- `self-hosted:host` ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –Ω–∞ —Ö–æ—Å—Ç–µ (–±–µ–∑ Docker)
- `linux/amd64:host` ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–∞ —Ö–æ—Å—Ç–µ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤:
```bash
docker run --rm gitea/act_runner:latest act_runner list-images
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `actions/cache` –≤ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö:

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–±–æ–¥–Ω—ã–π –ø–æ—Ä—Ç –Ω–∞ —Ö–æ—Å—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 8088)
2. –û—Ç–∫—Ä–æ–π—Ç–µ `config.yaml`:
```yaml
cache:
  enabled: true
  dir: ""
  host: "192.168.0.105"  # IP-–∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π
  port: 8088
```

3. –û–±–Ω–æ–≤–∏—Ç–µ `docker-compose.yml`:
```yaml
services:
  runner:
    # ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ...
    ports:
      - "8088:8088"  # –ü—Ä–æ–±—Ä–æ—Å –ø–æ—Ä—Ç–∞ –∫–µ—à–∞
```

### –≠—Ñ–µ–º–µ—Ä–Ω—ã–µ —Ä–∞–Ω–Ω–µ—Ä—ã (–ø–æ–≤—ã—à–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
–î–ª—è —Ä–µ–∂–∏–º–∞ "–æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞ ‚Äî –æ–¥–∏–Ω —Ä–∞–Ω–Ω–µ—Ä":

1. –í `.env` –¥–æ–±–∞–≤—å—Ç–µ:
```bash
RUNNER_EPHEMERAL="1"
```

2. –û–±–Ω–æ–≤–∏—Ç–µ `docker-compose.yml`:
```yaml
services:
  runner:
    environment:
      # ... –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ...
      GITEA_RUNNER_EPHEMERAL: "${RUNNER_EPHEMERAL:-0}"
    volumes:
      # –£–ë–†–ê–¢–¨ —Ç–æ–º /data –¥–ª—è —ç—Ñ–µ–º–µ—Ä–Ω—ã—Ö —Ä–∞–Ω–Ω–µ—Ä–æ–≤:
      # - ./data:/data
      - ./config.yaml:/config.yaml
      - /var/run/docker.sock:/var/run/docker.sock
```
### –ü—Ä–∏–º–µ—Ä –≥–æ—Ç–æ–≤–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞
```yaml
log:
  level: info

runner:
  file: .runner
  capacity: 1
  envs:
    A_TEST_ENV_NAME_1: a_test_env_value_1
    A_TEST_ENV_NAME_2: a_test_env_value_2
  env_file: .env
  timeout: 3h
  shutdown_timeout: 0s
  insecure: false
  fetch_timeout: 5s
  fetch_interval: 2s
  github_mirror: ''
  labels:
    - "ubuntu-latest:docker://docker.gitea.com/runner-images:ubuntu-latest"
    - "ubuntu-22.04:docker://docker.gitea.com/runner-images:ubuntu-22.04"
    - "ubuntu-20.04:docker://docker.gitea.com/runner-images:ubuntu-20.04"

cache:
  enabled: true
  dir: ""
  host: "192.168.0.105"
  port: 8088
  external_server: ""

container:
  network: "gitea_gitea"
  privileged: false
  options:
  workdir_parent:
  valid_volumes: []
  docker_host: ""
  force_pull: true
  force_rebuild: false
  require_docker: false
  docker_timeout: 0s

host:
  workdir_parent:
```
## üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Gitea
–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å —Ä–∞–Ω–Ω–µ—Ä–∞ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Gitea:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `https://gitea.your-domain.com/-/admin/actions/runners`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–Ω–Ω–µ—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "Online"
3. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å "Offline", –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs runner`

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker compose logs -f runner

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∑–∞–¥–∞—á
docker ps --filter "label=github_actions"

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
docker stats gitea_act_runner
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ó–∞–ø—É—Å–∫ —Ä–∞–Ω–Ω–µ—Ä–∞
docker compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–∞–Ω–Ω–µ—Ä–∞
docker compose down

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Ä–∞–Ω–Ω–µ—Ä–∞
docker compose restart

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
docker compose pull && docker compose up -d --force-recreate
```

### –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ`manage.sh` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

–î–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
```bash
chmod +x manage.sh
./manage.sh start
```

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ü—Ä–æ–±–ª–µ–º–∞: –†–∞–Ω–Ω–µ—Ä –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Gitea
**–°–∏–º–ø—Ç–æ–º—ã:** –°—Ç–∞—Ç—É—Å "Offline" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ Gitea

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker compose logs runner`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL Gitea –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (HTTPS vs HTTP)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–∞–Ω–Ω–µ—Ä –º–æ–∂–µ—Ç —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è Gitea:
   ```bash
   docker exec gitea_act_runner ping gitea.gsrcloud.ru
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –ó–∞–¥–∞—á–∏ –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
**–°–∏–º–ø—Ç–æ–º—ã:** Workflow –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ —Å—Ç–∞—Ç—É—Å–µ "pending"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–µ–π–±–ª—ã —Ä–∞–Ω–Ω–µ—Ä–∞:
   ```bash
   docker exec gitea_act_runner cat /data/.runner
   ```
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ workflow —É–∫–∞–∑–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `runs-on`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ Docker socket –¥–æ—Å—Ç—É–ø–µ–Ω:
   ```bash
   docker exec gitea_act_runner ls -la /var/run/docker.sock
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –≤ –∑–∞–¥–∞—á–∞—Ö
**–°–∏–º–ø—Ç–æ–º—ã:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–¥–∞—á –Ω–µ –º–æ–≥—É—Ç –≤—ã–π—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ö–æ—Å—Ç –∏–º–µ–µ—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ DNS –≤ `config.yaml`:
   ```yaml
   container:
     network: "gitea_gitea"
     options:
       --dns: 8.8.8.8
       --dns: 8.8.4.4
   ```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ñ–µ–º–µ—Ä–Ω—ã–µ —Ä–∞–Ω–Ω–µ—Ä—ã** –¥–ª—è production-—Å—Ä–µ–¥
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ Docker socket**
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—Ä–∞–∑** —Ä–∞–Ω–Ω–µ—Ä–∞
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
```bash
# –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥—è—â–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo ufw default deny incoming
sudo ufw default allow outgoing

# –†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Gitea (–µ—Å–ª–∏ –Ω–∞ —Ç–æ–º –∂–µ —Å–µ—Ä–≤–µ—Ä–µ)
sudo ufw allow from 192.168.0.0/24 to any port 3000
```

## üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ä–∞–Ω–Ω–µ—Ä–æ–≤
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `docker-compose.scale.yml`:

```yaml
version: "3.8"

services:
  runner-1:
    extends:
      file: docker-compose.yml
      service: runner
    container_name: gitea_act_runner_1
    environment:
      GITEA_RUNNER_NAME: "runner-1"
  
  runner-2:
    extends:
      file: docker-compose.yml
      service: runner
    container_name: gitea_act_runner_2
    environment:
      GITEA_RUNNER_NAME: "runner-2"
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
docker compose -f docker-compose.scale.yml up -d
```

### –ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏
–î–ª—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–∞–Ω–Ω–µ—Ä–∞–º–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ª–µ–π–±–ª—ã:

```bash
# –†–∞–Ω–Ω–µ—Ä 1 - –¥–ª—è —Ç–µ—Å—Ç–æ–≤
RUNNER_LABELS="test:docker://alpine:latest"

# –†–∞–Ω–Ω–µ—Ä 2 - –¥–ª—è —Å–±–æ—Ä–∫–∏
RUNNER_LABELS="build:docker://node:20-bullseye"

# –†–∞–Ω–Ω–µ—Ä 3 - –¥–ª—è production
RUNNER_LABELS="prod:docker://ubuntu:22.04"
```

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
gitea-runner/
‚îú‚îÄ‚îÄ docker-compose.yml     # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker
‚îú‚îÄ‚îÄ config.yaml           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Act Runner
‚îú‚îÄ‚îÄ .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
‚îú‚îÄ‚îÄ README.md            # –≠—Ç–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ data/                # –î–∞–Ω–Ω—ã–µ —Ä–∞–Ω–Ω–µ—Ä–∞ (—Å–æ–∑–¥–∞–µ—Ç—Å—è)
‚îî‚îÄ‚îÄ logs/                # –õ–æ–≥–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
–î–æ–±–∞–≤—å—Ç–µ –≤ crontab:
```bash
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è–º –≤ 3:00
0 3 * * 0 cd /home/gsr/hub/gitea-runner && docker compose pull && docker compose up -d >> /var/log/gitea-runner-update.log 2>&1
```

### –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
cd /home/gsr/hub/gitea-runner
docker compose pull
docker compose up -d --force-recreate
docker system prune -f  # –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤
```

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç
Pull requests –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è! –î–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ issue —Å–Ω–∞—á–∞–ª–∞ –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è.

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
- Issues: https://github.com/gsrlabs/gitea-runner/issues
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Gitea Actions: https://docs.gitea.com/usage/actions/overview
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Act Runner: https://docs.gitea.com/usage/actions/act-runner

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
MIT

---

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠—Ç–æ—Ç —Ä–∞–Ω–Ω–µ—Ä –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Gitea Actions. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ –≤ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö –∏ —á—Ç–æ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞ –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ.